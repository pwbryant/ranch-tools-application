<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Report Five</title>
    <style>
        .green-bg {
            background-color: #90EE90;
            font-weight: bold;
        }
        .yellow-bg {
            background-color: #FFFF99;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="nav-container">
        <a href="{% url 'pregcheck-reports' %}" class="nav-button">← Back to Reports</a>
        <a href="/pregchecks" class="nav-button">← Back to Pregnancy Checks</a>
    </div>
    <h1>Report Five — Summary by Birth Year</h1>

    <form method="get" action="">
        <label for="breeding_season">Breeding season:</label>
        <input type="text" id="breeding_season" name="breeding_season" value="{{ breeding_season }}" />
        <button type="submit">Update Breeding Season</button>
    </form>

    <table border="1" cellpadding="6" cellspacing="0">
        <thead>
            <tr>
                <th>Cow Birth Year</th>
                <th>Age</th>
                <th>First Pass Open</th>
                <th>First Pass Pregnant</th>
                <th>First Pass Total</th>
                <th>Preg Recheck Count</th>
                <th>Net Open</th>
                <th>Net Pregnant</th>
                <th>% Pregnant</th>
            </tr>
        </thead>
        <tbody>
            {% for row in rows %}
            <tr>
                <td>{{ row.cow_birth_year }}</td>
                <td>{{ row.age }}</td>
                <td>{{ row.first_pass_open }}</td>
                <td>{{ row.first_pass_pregnant }}</td>
                <td>{{ row.first_pass_total }}</td>
                <td>{{ row.preg_recheck_count }}</td>
                <td>{{ row.net_open }}</td>
                <td>{{ row.net_pregnant }}</td>
                <td 
                    {% with pct_value=row.pct_pregnant|slice:":-1"|floatformat:0 %}
                        {% if pct_value|add:"0" >= 90 %}
                            class="green-bg"
                        {% elif pct_value|add:"0" < 70 %}
                            class="yellow-bg"
                        {% endif %}
                    {% endwith %}
                >{{ row.pct_pregnant }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="9">No data for this season.</td></tr>
            {% endfor %}
            {% if totals %}
            <tr style="background-color: #e0e0e0; font-weight: bold;">
                <td>{{ totals.cow_birth_year }}</td>
                <td>{{ totals.age }}</td>
                <td>{{ totals.first_pass_open }}</td>
                <td>{{ totals.first_pass_pregnant }}</td>
                <td>{{ totals.first_pass_total }}</td>
                <td>{{ totals.preg_recheck_count }}</td>
                <td>{{ totals.net_open }}</td>
                <td>{{ totals.net_pregnant }}</td>
                <td 
                    {% with pct_value=totals.pct_pregnant|slice:":-1"|floatformat:0 %}
                        {% if pct_value|add:"0" >= 90 %}
                            class="green-bg"
                        {% elif pct_value|add:"0" < 70 %}
                            class="yellow-bg"
                        {% endif %}
                    {% endwith %}
                >{{ totals.pct_pregnant }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</body>
</html>
